---
phase: 01-quick-wins
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/graph/overview_page.dart
  - lib/app_search.dart
  - lib/sets/history_page.dart
autonomous: true

must_haves:
  truths:
    - "User sees Total Time card on overview page showing accumulated workout duration"
    - "Total time updates when user changes period selector (week/month/year/etc)"
    - "Total time displays as 'Xh Ym' format, or '0h 0m' when no workouts"
    - "Three-dots menu no longer appears in history search bar"
  artifacts:
    - path: "lib/graph/overview_page.dart"
      provides: "Total time stat calculation and display"
      contains: "totalTimeSeconds"
    - path: "lib/app_search.dart"
      provides: "Optional menu visibility parameter"
      contains: "showMenu"
    - path: "lib/sets/history_page.dart"
      provides: "AppSearch with hidden menu"
      contains: "showMenu: false"
  key_links:
    - from: "overview_page.dart"
      to: "StatCard widget"
      via: "Total Time card in stats grid"
      pattern: "StatCard.*Total Time"
    - from: "history_page.dart"
      to: "AppSearch widget"
      via: "showMenu parameter"
      pattern: "AppSearch.*showMenu.*false"
---

<objective>
Add total workout time statistic to overview page and remove three-dots menu from history search bar.

Purpose: Complete Phase 1 Quick Wins - low-risk UI improvements that surface existing data and clean up the interface.
Output: Modified overview_page.dart with new stat card, modified app_search.dart with optional menu, modified history_page.dart to hide menu.
</objective>

<execution_context>
@/home/aquatic/.claude/get-shit-done/workflows/execute-plan.md
@/home/aquatic/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-quick-wins/01-CONTEXT.md
@.planning/phases/01-quick-wins/01-RESEARCH.md

@lib/graph/overview_page.dart
@lib/widgets/stats/stat_card.dart
@lib/app_search.dart
@lib/sets/history_page.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Total Time stat card to overview page</name>
  <files>lib/graph/overview_page.dart</files>
  <action>
    1. Add state variable for total time:
       - Add `int totalTimeSeconds = 0;` alongside existing state variables (line ~27)

    2. Add SQL query in `_loadData()` method after the workouts count query (around line 158):
       ```dart
       // Calculate total workout time
       final totalTimeQuery = await db.customSelect(
         '''
         SELECT COALESCE(SUM(end_time - start_time), 0) as total_seconds
         FROM workouts
         WHERE start_time >= ?
           AND end_time IS NOT NULL
         ''',
         variables: [
           drift.Variable.withInt(startDate.millisecondsSinceEpoch ~/ 1000),
         ],
       ).getSingleOrNull();

       final totalSeconds = totalTimeQuery?.read<int?>('total_seconds') ?? 0;
       ```

    3. Update setState block to include `totalTimeSeconds = totalSeconds;` (around line 225)

    4. Add helper method for formatting duration (add after `_calculateStreak` method):
       ```dart
       String _formatTotalTime(int totalSeconds) {
         final duration = Duration(seconds: totalSeconds);
         final hours = duration.inHours;
         final minutes = duration.inMinutes % 60;
         return '${hours}h ${minutes}m';
       }
       ```

    5. Add third row to stats cards in `_buildStatsCards` method (after line 652, before the closing of the Column children):
       ```dart
       const SizedBox(height: 12),
       Row(
         children: [
           Expanded(
             child: StatCard(
               icon: Icons.schedule,
               label: 'Total Time',
               value: _formatTotalTime(totalTimeSeconds),
               color: colorScheme.primary,
             ),
           ),
           const SizedBox(width: 12),
           const Expanded(child: SizedBox()),  // Placeholder for symmetry
         ],
       ),
       ```

    Note: Use `Icons.schedule` for the time icon (matches Material Design conventions). Card uses `colorScheme.primary` to match the Workouts card above it.
  </action>
  <verify>Run `flutter analyze` or manually verify the app shows Total Time stat card on overview page that updates with period changes.</verify>
  <done>
    - Total Time card appears in overview stats section showing "Xh Ym" format
    - Value updates when period selector changes
    - Zero workouts shows "0h 0m"
    - Card styling matches existing stat cards
  </done>
</task>

<task type="auto">
  <name>Task 2: Hide three-dots menu in history search bar</name>
  <files>lib/app_search.dart, lib/sets/history_page.dart</files>
  <action>
    1. Modify AppSearch widget to accept optional `showMenu` parameter:
       - Add parameter to constructor: `this.showMenu = true,` after existing parameters (line ~13)
       - Add field: `final bool showMenu;` after existing fields (line ~26)

    2. Conditionally render the menu IconButton (lines 125-231):
       - Wrap the `Badge.count(...)` widget containing the menu IconButton in a conditional:
       ```dart
       if (widget.showMenu)
         Badge.count(
           count: widget.selected.length,
           // ... existing menu code unchanged
         ),
       ```

    3. Update both AppSearch usages in history_page.dart to hide the menu:
       - First usage (line ~103, workouts view): Add `showMenu: false,` parameter
       - Second usage (line ~172, sets view): Add `showMenu: false,` parameter

    Note: The three-dots menu provides Add, Timer, Select all, Edit, Share, Settings options. In history context, these are either not applicable or accessible elsewhere. The search, filter, and delete functionality remain intact via other UI elements.
  </action>
  <verify>Run `flutter analyze` or manually verify the history page no longer shows three-dots menu in either workouts or sets view.</verify>
  <done>
    - Three-dots menu icon no longer visible in history search bar
    - Search functionality still works
    - Delete button still appears when items selected
    - Filter widget still appears in sets view
    - Other pages using AppSearch are unaffected (default showMenu: true)
  </done>
</task>

</tasks>

<verification>
1. Overview page displays Total Time stat card with accumulated duration
2. Total Time value changes when period selector changes (week/month/year/etc)
3. Total Time shows "0h 0m" when no workouts exist in selected period
4. History page (both workouts and sets views) no longer shows three-dots menu
5. All existing functionality preserved (search, filter, delete, selection)
</verification>

<success_criteria>
- STATS-01 satisfied: Total workout time card visible on overview page
- HIST-01 satisfied: Three-dots menu removed from history search bar
- No regressions: Other AppSearch usages unaffected, existing stat cards unchanged
- Code follows existing patterns in codebase
</success_criteria>

<output>
After completion, create `.planning/phases/01-quick-wins/01-01-SUMMARY.md`
</output>
