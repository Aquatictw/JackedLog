---
phase: 07-block-management
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - lib/notes/notes_page.dart
autonomous: false

must_haves:
  truths:
    - "Banner displays FiveThreeOneState.positionLabel text when an active block exists"
    - "Banner shows 'Start a 5/3/1 block' prompt text when no active block exists"
    - "Tapping banner with active block pushes BlockOverviewPage route"
    - "Tapping banner without active block opens BlockCreationDialog via showDialog"
    - "Banner is self-contained (no onTap parameter) and always visible in all 3 notes page list states"
  artifacts:
    - path: "lib/notes/notes_page.dart"
      provides: "Block-aware _TrainingMaxBanner with dynamic content"
  key_links:
    - from: "lib/notes/notes_page.dart"
      to: "lib/fivethreeone/fivethreeone_state.dart"
      via: "context.watch<FiveThreeOneState>() for hasActiveBlock and positionLabel"
      pattern: "FiveThreeOneState"
    - from: "lib/notes/notes_page.dart"
      to: "lib/fivethreeone/block_overview_page.dart"
      via: "Navigator.push to BlockOverviewPage on banner tap"
      pattern: "BlockOverviewPage"
    - from: "lib/notes/notes_page.dart"
      to: "lib/fivethreeone/block_creation_dialog.dart"
      via: "showDialog opens BlockCreationDialog when no active block"
      pattern: "BlockCreationDialog"
---

<objective>
Replace the static "5/3/1 Training Max" banner on the notes page with a dynamic block-aware banner that shows current block position or a prompt to start a block.

Purpose: This is the primary daily touchpoint for 5/3/1 users. The banner tells them where they are in the program and provides one-tap access to the block overview. Covers BLOCK-05.

Output: Updated notes page with block-aware banner that responds to FiveThreeOneState changes.
</objective>

<execution_context>
@/home/aquatic/.claude/get-shit-done/workflows/execute-plan.md
@/home/aquatic/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-block-management/07-RESEARCH.md
@.planning/phases/07-block-management/07-CONTEXT.md
@.planning/phases/07-block-management/07-01-SUMMARY.md
@lib/notes/notes_page.dart
@lib/fivethreeone/fivethreeone_state.dart
@lib/fivethreeone/block_overview_page.dart
@lib/fivethreeone/block_creation_dialog.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace notes page banner with block-aware version</name>
  <files>
    lib/notes/notes_page.dart
  </files>
  <action>
Modify the existing `_TrainingMaxBanner` widget in `notes_page.dart` to be block-aware. The banner appears in 3 places in the page (empty search results, empty notes, notes list view). All 3 instances pass an `onTap` callback.

**Changes to `_TrainingMaxBanner`:**

1. Remove the `onTap` parameter. The banner will handle its own navigation internally.

2. Add `context.watch<FiveThreeOneState>()` to read block state reactively.

3. **When active block exists** (`fiveThreeOneState.hasActiveBlock`):
   - Keep the same visual style (Container with Material elevation, primaryContainer background, gradient, rounded corners)
   - Change the text from static `'5/3/1 Training Max'` to dynamic `fiveThreeOneState.positionLabel` (e.g., "Leader 2 — Week 2 • 5's PRO")
   - On tap: navigate to `BlockOverviewPage` via `Navigator.of(context).push(MaterialPageRoute(builder: (_) => const BlockOverviewPage()))`
   - Keep the same icon (Icons.fitness_center) and chevron_right

4. **When no active block** (`!fiveThreeOneState.hasActiveBlock`):
   - Same visual container but use a slightly different style to indicate it's a prompt (can use `surfaceContainerHigh` instead of `primaryContainer`, or keep `primaryContainer` with different text styling)
   - Text: `'Start a 5/3/1 block →'`
   - On tap: open `BlockCreationDialog` via `showDialog(context: context, builder: (_) => const BlockCreationDialog())`
   - Keep the same icon and layout

5. **Update all 3 call sites** that instantiate `_TrainingMaxBanner`:
   - Remove the `onTap` parameter from all 3 places (lines ~221, ~264, ~319)
   - The banner is now self-contained

6. **Update imports** at top of file:
   - Add: `import 'package:provider/provider.dart';`
   - Add: `import '../fivethreeone/fivethreeone_state.dart';`
   - Add: `import '../fivethreeone/block_overview_page.dart';`
   - Add: `import '../fivethreeone/block_creation_dialog.dart';`
   - The existing import of `training_max_editor.dart` can be REMOVED since the banner no longer opens TrainingMaxEditor directly. BUT check if TrainingMaxEditor is used elsewhere in the file first -- if not, remove the import.

**Important:** The banner must always render regardless of block state. When `hasActiveBlock` is false, show the prompt. When true, show position. Never hide the banner area.
  </action>
  <verify>
Read `lib/notes/notes_page.dart` and confirm:
- `_TrainingMaxBanner` no longer takes an `onTap` parameter
- Uses `context.watch<FiveThreeOneState>()` for reactive state
- Shows `positionLabel` text when active block exists
- Shows "Start a 5/3/1 block" prompt when no active block
- Tapping with active block navigates to BlockOverviewPage
- Tapping without active block opens BlockCreationDialog
- All 3 call sites updated to not pass `onTap`
- Provider import added
  </verify>
  <done>
Notes page banner dynamically shows block position or start prompt. Tapping navigates to overview page or creation dialog respectively. Banner always visible at top of notes page.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete 5/3/1 Block Management feature:
1. Block creation dialog (Settings -> 5/3/1 Block)
2. Block overview page with vertical timeline
3. Week/cycle advancement with TM bump confirmation
4. Notes page banner showing block position
  </what-built>
  <how-to-verify>
1. Open Settings page and tap "5/3/1 Block" -- creation dialog should appear with 4 TM fields pre-filled from your existing TM settings
2. Enter TM values and tap "Start Block" -- dialog should close
3. Go to Notes page -- banner should show "Leader 1 — Week 1 • 5's PRO"
4. Tap the banner -- should navigate to Block Overview page showing 5 cycles with Leader 1 highlighted
5. Tap "Complete Week" 3 times to advance through Leader 1 (W1->W2->W3->next cycle). On the 3rd tap, a TM bump dialog should appear showing old -> new TM values
6. Confirm or skip the TM bump -- should advance to Leader 2 Week 1
7. Go back to Notes page -- banner should now show "Leader 2 — Week 1 • 5's PRO"
8. Verify the overview page shows Leader 1 as completed (muted/green) and Leader 2 as current (highlighted)
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Read `lib/notes/notes_page.dart` and confirm banner is block-aware with both states
2. Verify all 3 banner call sites updated (no onTap parameter)
3. Verify imports include provider, fivethreeone_state, block_overview_page, block_creation_dialog
4. Human verification covers end-to-end flow
</verification>

<success_criteria>
- Notes page banner shows block position when active block exists
- Notes page banner shows "Start a 5/3/1 block" prompt when no active block
- Banner taps navigate correctly (overview page or creation dialog)
- Human verified the full end-to-end flow works
</success_criteria>

<output>
After completion, create `.planning/phases/07-block-management/07-02-SUMMARY.md`
</output>
