# Milestone v1.2: 5/3/1 Forever Block Programming

**Status:** SHIPPED 2026-02-11
**Phases:** 6-9
**Total Plans:** 5

## Overview

Add 5/3/1 Forever block programming support — users can create an 11-week training block, track their position through Leader/Anchor cycles, and get correct calculator prescriptions based on where they are in the block.

## Phases

### Phase 6: Data Foundation
**Goal**: All data infrastructure exists so block management and calculator features can build on a solid, tested foundation
**Depends on**: Nothing (new subsystem)
**Requirements**: INFRA-01, INFRA-02, INFRA-03
**Plans**: 1 plan

Plans:
- [x] 06-01: Database table, state management, and schemes module

**Details:**
- Drift table `fivethreeone_blocks` with 11 columns (TMs, cycle/week position, active status)
- Migration v63→v64 using CREATE TABLE IF NOT EXISTS
- Pure `schemes.dart` module with SetScheme typedef and const scheme data for all cycle types
- `FiveThreeOneState` ChangeNotifier with async init, registered in Provider tree

### Phase 7: Block Management
**Goal**: Users can create a training block, see where they are, and advance through the 11-week structure with correct TM progression
**Depends on**: Phase 6 (database table, state, schemes)
**Requirements**: BLOCK-01, BLOCK-02, BLOCK-03, BLOCK-04, BLOCK-05
**Plans**: 2 plans

Plans:
- [x] 07-01: Block creation, state methods, and overview page with advancement
- [x] 07-02: Notes page banner and human verification

**Details:**
- Block creation dialog with 4 TM fields, pre-fill from settings, validation
- Block overview page with custom vertical timeline showing 5 color-coded cycles
- Complete Week button with TM bump confirmation at cycle boundaries
- Notes page banner showing block position with navigation to overview
- Post-checkpoint refinements from user testing (7 UI fixes)

### Phase 8: Calculator Enhancement
**Goal**: Calculator automatically shows the correct work scheme and supplemental sets based on block position
**Depends on**: Phase 7 (block state with valid cycle/week position)
**Requirements**: CALC-01, CALC-02, CALC-03, CALC-04
**Plans**: 1 plan

Plans:
- [x] 08-01: Context-aware calculator with scheme switching and supplemental display

**Details:**
- Single widget with `_isBlockMode` flag for dual-mode calculator
- Scheme resolution via `getMainScheme()` dispatching by cycle type
- Supplemental section with compact single-line format ("BBB 5x10 @ weight")
- TM Test feedback banner with validation warning
- Manual mode preserved unchanged when no active block

### Phase 9: Block Completion
**Goal**: When a block finishes, user sees a meaningful summary of their TM progression across the entire 11-week block
**Depends on**: Phase 8 (full block lifecycle must be functional)
**Requirements**: BLOCK-06
**Plans**: 1 plan

Plans:
- [x] 09-01: Post-block summary and block completion flow

**Details:**
- 4 nullable `start_*_tm` columns added with v64→v65 migration and backfill
- BlockSummaryPage with lift progression cards (start → end TM with delta badge)
- Complete Block button on TM Test final week with pushReplacement navigation
- Block history list with FutureBuilder, tappable to view past summaries
- Pre-fill new block TMs from last completed block's ending TMs

---

## Milestone Summary

**Key Decisions:**
- Dedicated `fivethreeone_blocks` table (not extending Settings) for proper lifecycle management
- Single integer `current_cycle` (0-4) encodes block position across 5 cycle types
- Pure `schemes.dart` module with no UI/DB dependencies for all percentage/rep data
- Manual week advancement only (no auto-detection from workout completion)
- TM snapshots stored per block (not references to Settings values)
- StatelessWidget for BlockOverviewPage since state comes from Provider watch
- Single widget with `_isBlockMode` flag for dual-mode calculator
- Compact single-line supplemental display format
- Nullable start TM columns with fallback to current TMs for pre-migration blocks
- pushReplacement navigation for block completion
- Pre-fill new block TMs from last completed block's ending TMs

**Issues Resolved:**
- Future week indicator visibility (grey → onPrimaryContainer alpha)
- Floating-point arithmetic rounding in TM bumps (toStringAsFixed)
- Start TM columns migration self-heal (quick-006)

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- BLOCK-01 through BLOCK-05 requirements checkboxes not marked in REQUIREMENTS.md (all 6 BLOCK requirements were implemented but only BLOCK-06 was checked)

---

*For current project status, see .planning/ROADMAP.md*
